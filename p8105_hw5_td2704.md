P8105 Homework 5 \[td2704\]
================

``` r
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

``` r
homicide_data = read_csv("data/homicide-data.csv", na = c("", "Unknown"))
```

    ## Rows: 52179 Columns: 12

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (8): uid, victim_last, victim_first, victim_race, victim_sex, city, stat...
    ## dbl (4): reported_date, victim_age, lat, lon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
homicide_data
```

    ## # A tibble: 52,179 × 12
    ##    uid        reported_date victim_last  victim_first victim_race victim_age
    ##    <chr>              <dbl> <chr>        <chr>        <chr>            <dbl>
    ##  1 Alb-000001      20100504 GARCIA       JUAN         Hispanic            78
    ##  2 Alb-000002      20100216 MONTOYA      CAMERON      Hispanic            17
    ##  3 Alb-000003      20100601 SATTERFIELD  VIVIANA      White               15
    ##  4 Alb-000004      20100101 MENDIOLA     CARLOS       Hispanic            32
    ##  5 Alb-000005      20100102 MULA         VIVIAN       White               72
    ##  6 Alb-000006      20100126 BOOK         GERALDINE    White               91
    ##  7 Alb-000007      20100127 MALDONADO    DAVID        Hispanic            52
    ##  8 Alb-000008      20100127 MALDONADO    CONNIE       Hispanic            52
    ##  9 Alb-000009      20100130 MARTIN-LEYVA GUSTAVO      White               56
    ## 10 Alb-000010      20100210 HERRERA      ISRAEL       Hispanic            43
    ## # … with 52,169 more rows, and 6 more variables: victim_sex <chr>, city <chr>,
    ## #   state <chr>, lat <dbl>, lon <dbl>, disposition <chr>

The raw homicide data has 52179 rows and 12 columns with variables uid,
reported\_date, victim\_last, victim\_first, victim\_race, victim\_age,
victim\_sex, city, state, lat, lon, disposition.  
\#\# ADD MORE DESCRIPTION

``` r
homicide_data_modified = 
  homicide_data %>%
  mutate(
    city_state = paste(city,state,sep = ", ")
  )
homicide_data_modified
```

    ## # A tibble: 52,179 × 13
    ##    uid        reported_date victim_last  victim_first victim_race victim_age
    ##    <chr>              <dbl> <chr>        <chr>        <chr>            <dbl>
    ##  1 Alb-000001      20100504 GARCIA       JUAN         Hispanic            78
    ##  2 Alb-000002      20100216 MONTOYA      CAMERON      Hispanic            17
    ##  3 Alb-000003      20100601 SATTERFIELD  VIVIANA      White               15
    ##  4 Alb-000004      20100101 MENDIOLA     CARLOS       Hispanic            32
    ##  5 Alb-000005      20100102 MULA         VIVIAN       White               72
    ##  6 Alb-000006      20100126 BOOK         GERALDINE    White               91
    ##  7 Alb-000007      20100127 MALDONADO    DAVID        Hispanic            52
    ##  8 Alb-000008      20100127 MALDONADO    CONNIE       Hispanic            52
    ##  9 Alb-000009      20100130 MARTIN-LEYVA GUSTAVO      White               56
    ## 10 Alb-000010      20100210 HERRERA      ISRAEL       Hispanic            43
    ## # … with 52,169 more rows, and 7 more variables: victim_sex <chr>, city <chr>,
    ## #   state <chr>, lat <dbl>, lon <dbl>, disposition <chr>, city_state <chr>

``` r
homicide_counts_df = 
  homicide_data_modified %>%
  group_by(city_state, disposition) %>%
  summarise(
    homicides_by_disposition = n()
  ) %>%
  group_by(city_state) %>%
  mutate(
    total_num_homicides = sum(homicides_by_disposition)
  ) %>%
  filter(disposition == "Closed without arrest" | disposition == "Open/No arrest") %>%
  group_by(city_state) %>%
  mutate(
    num_unsolved_homicides = sum(homicides_by_disposition)
  ) %>%
  select(city_state, total_num_homicides, num_unsolved_homicides) %>%
  distinct(city_state, total_num_homicides, num_unsolved_homicides)
```

    ## `summarise()` has grouped output by 'city_state'. You can override using the `.groups` argument.

``` r
homicide_counts_df
```

    ## # A tibble: 50 × 3
    ## # Groups:   city_state [50]
    ##    city_state      total_num_homicides num_unsolved_homicides
    ##    <chr>                         <int>                  <int>
    ##  1 Albuquerque, NM                 378                    146
    ##  2 Atlanta, GA                     973                    373
    ##  3 Baltimore, MD                  2827                   1825
    ##  4 Baton Rouge, LA                 424                    196
    ##  5 Birmingham, AL                  800                    347
    ##  6 Boston, MA                      614                    310
    ##  7 Buffalo, NY                     521                    319
    ##  8 Charlotte, NC                   687                    206
    ##  9 Chicago, IL                    5535                   4073
    ## 10 Cincinnati, OH                  694                    309
    ## # … with 40 more rows

For Baltimore, MD:

``` r
baltimore_data = 
  homicide_counts_df %>%
  filter(city_state == "Baltimore, MD")

baltimore_prop_test = 
  prop.test(
    x = pull(baltimore_data, num_unsolved_homicides),
    n = pull(baltimore_data, total_num_homicides)
    )

baltimore_prop_test
```

    ## 
    ##  1-sample proportions test with continuity correction
    ## 
    ## data:  pull(baltimore_data, num_unsolved_homicides) out of pull(baltimore_data, total_num_homicides), null probability 0.5
    ## X-squared = 239.01, df = 1, p-value < 2.2e-16
    ## alternative hypothesis: true p is not equal to 0.5
    ## 95 percent confidence interval:
    ##  0.6275625 0.6631599
    ## sample estimates:
    ##         p 
    ## 0.6455607

``` r
baltimore_prop_test %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
```

    ## # A tibble: 1 × 3
    ##   estimate conf.low conf.high
    ##      <dbl>    <dbl>     <dbl>
    ## 1    0.646    0.628     0.663

Let’s make what we did for Baltimore, MD into a function so that we can
apply this across all cities in our df.

``` r
prop_test_city_function = function(city) {
  city_data = 
    homicide_counts_df %>%
    filter(city_state == city)
  
  city_prop_test = 
    prop.test(
      x = pull(city_data, num_unsolved_homicides),
      n = pull(city_data, total_num_homicides)
    )
  
  return(city_prop_test)
}
```

Apply this function to all cities in homicide\_counts\_df.

``` r
homicide_counts_df
```

    ## # A tibble: 50 × 3
    ## # Groups:   city_state [50]
    ##    city_state      total_num_homicides num_unsolved_homicides
    ##    <chr>                         <int>                  <int>
    ##  1 Albuquerque, NM                 378                    146
    ##  2 Atlanta, GA                     973                    373
    ##  3 Baltimore, MD                  2827                   1825
    ##  4 Baton Rouge, LA                 424                    196
    ##  5 Birmingham, AL                  800                    347
    ##  6 Boston, MA                      614                    310
    ##  7 Buffalo, NY                     521                    319
    ##  8 Charlotte, NC                   687                    206
    ##  9 Chicago, IL                    5535                   4073
    ## 10 Cincinnati, OH                  694                    309
    ## # … with 40 more rows
